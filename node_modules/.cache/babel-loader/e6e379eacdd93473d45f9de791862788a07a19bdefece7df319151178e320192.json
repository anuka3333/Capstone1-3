{"ast":null,"code":"import React,{useState,useEffect,useCallback}from'react';import{useAuth0}from'@auth0/auth0-react';import AlbumForm from'./AlbumForm';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Albums=()=>{const{user,isAuthenticated,isLoading,getAccessTokenSilently}=useAuth0();const[albums,setAlbums]=useState([]);// Debug logging (use JSON.stringify so console shows a snapshot)\nconsole.log('Albums component render:');console.log('isLoading:',isLoading);console.log('isAuthenticated:',isAuthenticated);console.log('user:',JSON.stringify(user));// Normalize roles: handle array, comma-separated string, or single role string\nconst rawRoles=(user===null||user===void 0?void 0:user['https://anukaphotos333/roles'])||(user===null||user===void 0?void 0:user.roles)||(user===null||user===void 0?void 0:user.role)||(user===null||user===void 0?void 0:user['roles']);let roles=[];if(Array.isArray(rawRoles)){roles=rawRoles;}else if(typeof rawRoles==='string'&&rawRoles.trim()!==''){roles=rawRoles.split(',').map(r=>r.trim());}else if(rawRoles){// fallback for single non-array value\nroles=[String(rawRoles)];}// Normalize to lowercase for case-insensitive checks\nconst normalizedRoles=roles.map(r=>String(r).toLowerCase());console.log('raw roles:',JSON.stringify(rawRoles),'normalized roles:',JSON.stringify(normalizedRoles),'isArray:',Array.isArray(rawRoles));const isAdmin=normalizedRoles.includes('admin');const debugString=`rawRoles: ${JSON.stringify(rawRoles)}\\nnormalizedRoles: ${JSON.stringify(normalizedRoles)}\\nisAdmin: ${isAdmin}`;console.log(debugString);const fetchAlbums=useCallback(async()=>{try{const token=await getAccessTokenSilently();const response=await axios.get('/api/albums',{headers:{Authorization:`Bearer ${token}`}});setAlbums(response.data);}catch(err){console.error(\"Failed to fetch albums:\",err);}},[getAccessTokenSilently]);useEffect(()=>{if(isAuthenticated&&user){fetchAlbums();}},[isAuthenticated,user,fetchAlbums]);// More robust loading check\nif(isLoading||isAuthenticated&&!user){return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});}if(!isAuthenticated){return/*#__PURE__*/_jsx(\"div\",{children:\"Please log in to view albums.\"});}// roles already normalized above; use isAdmin from earlier\nreturn/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px'},children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Albums\"}),/*#__PURE__*/_jsx(\"pre\",{style:{whiteSpace:'pre-wrap',background:'#f6f8fa',padding:'8px',borderRadius:'4px'},children:debugString}),isAdmin&&/*#__PURE__*/_jsx(AlbumForm,{onAlbumCreated:fetchAlbums}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'20px'},children:albums.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No albums available.\"}):/*#__PURE__*/_jsx(\"ul\",{style:{listStyle:'none',padding:0},children:albums.map(album=>/*#__PURE__*/_jsxs(\"li\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:album.name}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:'10px',flexWrap:'wrap'},children:album.photos.map((photo,idx)=>/*#__PURE__*/_jsx(\"img\",{src:photo.url,alt:photo.name,style:{width:'150px',height:'150px',objectFit:'cover',borderRadius:'5px'}},idx))})]},album.id))})})]});};export default Albums;","map":{"version":3,"names":["React","useState","useEffect","useCallback","useAuth0","AlbumForm","axios","jsx","_jsx","jsxs","_jsxs","Albums","user","isAuthenticated","isLoading","getAccessTokenSilently","albums","setAlbums","console","log","JSON","stringify","rawRoles","roles","role","Array","isArray","trim","split","map","r","String","normalizedRoles","toLowerCase","isAdmin","includes","debugString","fetchAlbums","token","response","get","headers","Authorization","data","err","error","children","style","padding","whiteSpace","background","borderRadius","onAlbumCreated","marginTop","length","listStyle","album","marginBottom","name","display","gap","flexWrap","photos","photo","idx","src","url","alt","width","height","objectFit","id"],"sources":["/Users/anukherlen/capstone1-3/src/components/Albums.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport { useAuth0 } from '@auth0/auth0-react';\nimport AlbumForm from './AlbumForm';\nimport axios from 'axios';\n\nconst Albums = () => {\n  const { user, isAuthenticated, isLoading, getAccessTokenSilently } = useAuth0();\n  const [albums, setAlbums] = useState([]);\n\n  // Debug logging (use JSON.stringify so console shows a snapshot)\n  console.log('Albums component render:');\n  console.log('isLoading:', isLoading);\n  console.log('isAuthenticated:', isAuthenticated);\n  console.log('user:', JSON.stringify(user));\n  \n  // Normalize roles: handle array, comma-separated string, or single role string\n  const rawRoles = user?.['https://anukaphotos333/roles'] || user?.roles || user?.role || user?.['roles'];\n  let roles = [];\n  if (Array.isArray(rawRoles)) {\n    roles = rawRoles;\n  } else if (typeof rawRoles === 'string' && rawRoles.trim() !== '') {\n    roles = rawRoles.split(',').map(r => r.trim());\n  } else if (rawRoles) {\n    // fallback for single non-array value\n    roles = [String(rawRoles)];\n  }\n  // Normalize to lowercase for case-insensitive checks\n  const normalizedRoles = roles.map(r => String(r).toLowerCase());\n  console.log('raw roles:', JSON.stringify(rawRoles), 'normalized roles:', JSON.stringify(normalizedRoles), 'isArray:', Array.isArray(rawRoles));\n  const isAdmin = normalizedRoles.includes('admin');\n  const debugString = `rawRoles: ${JSON.stringify(rawRoles)}\\nnormalizedRoles: ${JSON.stringify(normalizedRoles)}\\nisAdmin: ${isAdmin}`;\n  console.log(debugString);\n\n  const fetchAlbums = useCallback(async () => {\n    try {\n      const token = await getAccessTokenSilently();\n      const response = await axios.get('/api/albums', {\n        headers: {\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      setAlbums(response.data);\n    } catch (err) {\n      console.error(\"Failed to fetch albums:\", err);\n    }\n  }, [getAccessTokenSilently]);\n\n  useEffect(() => {\n    if (isAuthenticated && user) {\n      fetchAlbums();\n    }\n  }, [isAuthenticated, user, fetchAlbums]);\n\n  // More robust loading check\n  if (isLoading || (isAuthenticated && !user)) {\n    return <div>Loading...</div>;\n  }\n\n  if (!isAuthenticated) {\n    return <div>Please log in to view albums.</div>;\n  }\n\n  // roles already normalized above; use isAdmin from earlier\n\n  return (\n    <div style={{ padding: '20px' }}>\n      <h1>Albums</h1>\n      \n      {/* Debug: show role detection values on the page */}\n      <pre style={{ whiteSpace: 'pre-wrap', background: '#f6f8fa', padding: '8px', borderRadius: '4px' }}>\n        {debugString}\n      </pre>\n\n      {/* Show the form if user is admin */}\n      {isAdmin && <AlbumForm onAlbumCreated={fetchAlbums} />}\n\n      {/* List all albums */}\n      <div style={{ marginTop: '20px' }}>\n        {albums.length === 0 ? (\n          <p>No albums available.</p>\n        ) : (\n          <ul style={{ listStyle: 'none', padding: 0 }}>\n            {albums.map((album) => (\n              <li key={album.id} style={{ marginBottom: '20px' }}>\n                <h3>{album.name}</h3>\n                <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>\n                  {album.photos.map((photo, idx) => (\n                    <img\n                      key={idx}\n                      src={photo.url}\n                      alt={photo.name}\n                      style={{ width: '150px', height: '150px', objectFit: 'cover', borderRadius: '5px' }}\n                    />\n                  ))}\n                </div>\n              </li>\n            ))}\n          </ul>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Albums;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CAC/D,OAASC,QAAQ,KAAQ,oBAAoB,CAC7C,MAAO,CAAAC,SAAS,KAAM,aAAa,CACnC,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAE1B,KAAM,CAAAC,MAAM,CAAGA,CAAA,GAAM,CACnB,KAAM,CAAEC,IAAI,CAAEC,eAAe,CAAEC,SAAS,CAAEC,sBAAuB,CAAC,CAAGX,QAAQ,CAAC,CAAC,CAC/E,KAAM,CAACY,MAAM,CAAEC,SAAS,CAAC,CAAGhB,QAAQ,CAAC,EAAE,CAAC,CAExC;AACAiB,OAAO,CAACC,GAAG,CAAC,0BAA0B,CAAC,CACvCD,OAAO,CAACC,GAAG,CAAC,YAAY,CAAEL,SAAS,CAAC,CACpCI,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAEN,eAAe,CAAC,CAChDK,OAAO,CAACC,GAAG,CAAC,OAAO,CAAEC,IAAI,CAACC,SAAS,CAACT,IAAI,CAAC,CAAC,CAE1C;AACA,KAAM,CAAAU,QAAQ,CAAG,CAAAV,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAG,8BAA8B,CAAC,IAAIA,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEW,KAAK,IAAIX,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAEY,IAAI,IAAIZ,IAAI,SAAJA,IAAI,iBAAJA,IAAI,CAAG,OAAO,CAAC,EACvG,GAAI,CAAAW,KAAK,CAAG,EAAE,CACd,GAAIE,KAAK,CAACC,OAAO,CAACJ,QAAQ,CAAC,CAAE,CAC3BC,KAAK,CAAGD,QAAQ,CAClB,CAAC,IAAM,IAAI,MAAO,CAAAA,QAAQ,GAAK,QAAQ,EAAIA,QAAQ,CAACK,IAAI,CAAC,CAAC,GAAK,EAAE,CAAE,CACjEJ,KAAK,CAAGD,QAAQ,CAACM,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAACC,CAAC,EAAIA,CAAC,CAACH,IAAI,CAAC,CAAC,CAAC,CAChD,CAAC,IAAM,IAAIL,QAAQ,CAAE,CACnB;AACAC,KAAK,CAAG,CAACQ,MAAM,CAACT,QAAQ,CAAC,CAAC,CAC5B,CACA;AACA,KAAM,CAAAU,eAAe,CAAGT,KAAK,CAACM,GAAG,CAACC,CAAC,EAAIC,MAAM,CAACD,CAAC,CAAC,CAACG,WAAW,CAAC,CAAC,CAAC,CAC/Df,OAAO,CAACC,GAAG,CAAC,YAAY,CAAEC,IAAI,CAACC,SAAS,CAACC,QAAQ,CAAC,CAAE,mBAAmB,CAAEF,IAAI,CAACC,SAAS,CAACW,eAAe,CAAC,CAAE,UAAU,CAAEP,KAAK,CAACC,OAAO,CAACJ,QAAQ,CAAC,CAAC,CAC9I,KAAM,CAAAY,OAAO,CAAGF,eAAe,CAACG,QAAQ,CAAC,OAAO,CAAC,CACjD,KAAM,CAAAC,WAAW,CAAG,aAAahB,IAAI,CAACC,SAAS,CAACC,QAAQ,CAAC,sBAAsBF,IAAI,CAACC,SAAS,CAACW,eAAe,CAAC,cAAcE,OAAO,EAAE,CACrIhB,OAAO,CAACC,GAAG,CAACiB,WAAW,CAAC,CAExB,KAAM,CAAAC,WAAW,CAAGlC,WAAW,CAAC,SAAY,CAC1C,GAAI,CACF,KAAM,CAAAmC,KAAK,CAAG,KAAM,CAAAvB,sBAAsB,CAAC,CAAC,CAC5C,KAAM,CAAAwB,QAAQ,CAAG,KAAM,CAAAjC,KAAK,CAACkC,GAAG,CAAC,aAAa,CAAE,CAC9CC,OAAO,CAAE,CACPC,aAAa,CAAE,UAAUJ,KAAK,EAChC,CACF,CAAC,CAAC,CACFrB,SAAS,CAACsB,QAAQ,CAACI,IAAI,CAAC,CAC1B,CAAE,MAAOC,GAAG,CAAE,CACZ1B,OAAO,CAAC2B,KAAK,CAAC,yBAAyB,CAAED,GAAG,CAAC,CAC/C,CACF,CAAC,CAAE,CAAC7B,sBAAsB,CAAC,CAAC,CAE5Bb,SAAS,CAAC,IAAM,CACd,GAAIW,eAAe,EAAID,IAAI,CAAE,CAC3ByB,WAAW,CAAC,CAAC,CACf,CACF,CAAC,CAAE,CAACxB,eAAe,CAAED,IAAI,CAAEyB,WAAW,CAAC,CAAC,CAExC;AACA,GAAIvB,SAAS,EAAKD,eAAe,EAAI,CAACD,IAAK,CAAE,CAC3C,mBAAOJ,IAAA,QAAAsC,QAAA,CAAK,YAAU,CAAK,CAAC,CAC9B,CAEA,GAAI,CAACjC,eAAe,CAAE,CACpB,mBAAOL,IAAA,QAAAsC,QAAA,CAAK,+BAA6B,CAAK,CAAC,CACjD,CAEA;AAEA,mBACEpC,KAAA,QAAKqC,KAAK,CAAE,CAAEC,OAAO,CAAE,MAAO,CAAE,CAAAF,QAAA,eAC9BtC,IAAA,OAAAsC,QAAA,CAAI,QAAM,CAAI,CAAC,cAGftC,IAAA,QAAKuC,KAAK,CAAE,CAAEE,UAAU,CAAE,UAAU,CAAEC,UAAU,CAAE,SAAS,CAAEF,OAAO,CAAE,KAAK,CAAEG,YAAY,CAAE,KAAM,CAAE,CAAAL,QAAA,CAChGV,WAAW,CACT,CAAC,CAGLF,OAAO,eAAI1B,IAAA,CAACH,SAAS,EAAC+C,cAAc,CAAEf,WAAY,CAAE,CAAC,cAGtD7B,IAAA,QAAKuC,KAAK,CAAE,CAAEM,SAAS,CAAE,MAAO,CAAE,CAAAP,QAAA,CAC/B9B,MAAM,CAACsC,MAAM,GAAK,CAAC,cAClB9C,IAAA,MAAAsC,QAAA,CAAG,sBAAoB,CAAG,CAAC,cAE3BtC,IAAA,OAAIuC,KAAK,CAAE,CAAEQ,SAAS,CAAE,MAAM,CAAEP,OAAO,CAAE,CAAE,CAAE,CAAAF,QAAA,CAC1C9B,MAAM,CAACa,GAAG,CAAE2B,KAAK,eAChB9C,KAAA,OAAmBqC,KAAK,CAAE,CAAEU,YAAY,CAAE,MAAO,CAAE,CAAAX,QAAA,eACjDtC,IAAA,OAAAsC,QAAA,CAAKU,KAAK,CAACE,IAAI,CAAK,CAAC,cACrBlD,IAAA,QAAKuC,KAAK,CAAE,CAAEY,OAAO,CAAE,MAAM,CAAEC,GAAG,CAAE,MAAM,CAAEC,QAAQ,CAAE,MAAO,CAAE,CAAAf,QAAA,CAC5DU,KAAK,CAACM,MAAM,CAACjC,GAAG,CAAC,CAACkC,KAAK,CAAEC,GAAG,gBAC3BxD,IAAA,QAEEyD,GAAG,CAAEF,KAAK,CAACG,GAAI,CACfC,GAAG,CAAEJ,KAAK,CAACL,IAAK,CAChBX,KAAK,CAAE,CAAEqB,KAAK,CAAE,OAAO,CAAEC,MAAM,CAAE,OAAO,CAAEC,SAAS,CAAE,OAAO,CAAEnB,YAAY,CAAE,KAAM,CAAE,EAH/Ea,GAIN,CACF,CAAC,CACC,CAAC,GAXCR,KAAK,CAACe,EAYX,CACL,CAAC,CACA,CACL,CACE,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAA5D,MAAM","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}